---
description: Codex CLI による並列コードレビューを実行し、統合レポートを生成
allowed-tools: Bash, Read, Write
argument-hint: [--code] [--ui] [--security] [--all]
---

# Codex Code Review

Codex CLI を使用した自動コードレビューを実行します。

## 概要

Claude Code と並列で Codex による追加レビューを実行し、両者の結果を統合レポートとして出力します。

## 使用方法

```bash
# 全レビューを実行
/codex-review --all

# 特定のレビューのみ実行
/codex-review --code       # コードレビューのみ
/codex-review --ui         # UI一貫性レビューのみ
/codex-review --security   # セキュリティレビューのみ

# 複数選択
/codex-review --code --security
```

## 実行手順

### Step 1: 引数解析

```bash
RUN_CODE=false
RUN_UI=false
RUN_SECURITY=false

for arg in "$@"; do
  case $arg in
    --all)
      RUN_CODE=true
      RUN_UI=true
      RUN_SECURITY=true
      ;;
    --code) RUN_CODE=true ;;
    --ui) RUN_UI=true ;;
    --security) RUN_SECURITY=true ;;
  esac
done

# デフォルトは --all
if [[ "$RUN_CODE" == "false" && "$RUN_UI" == "false" && "$RUN_SECURITY" == "false" ]]; then
  RUN_CODE=true
  RUN_UI=true
  RUN_SECURITY=true
fi
```

### Step 2: Codex レビューを並列実行

以下のコマンドを Bash tool で実行:

```bash
mkdir -p /tmp/codex-review

# Code Review
if [[ "$RUN_CODE" == "true" ]]; then
  codex exec "Code Review:
  1) Run 'npx tsc --noEmit' and report all TypeScript errors
  2) Find all 'any' type usages with file and line numbers
  3) Check for React Hooks violations
  4) Find hardcoded Japanese text outside i18n
  Format: File:Line - Issue - Severity (error/warning/info)" \
  > /tmp/codex-review/code-review.txt 2>&1 &
fi

# UI Consistency Review
if [[ "$RUN_UI" == "true" ]]; then
  codex exec "UI Consistency Review:
  Check all components in src/components/ against design system
  Find:
  1) Hardcoded colors not using useTheme()
  2) Hardcoded spacing values (padding, margin, gap)
  3) Inconsistent border radius usage
  4) Non-theme typography
  Format: File:Line - Issue" \
  > /tmp/codex-review/ui-review.txt 2>&1 &
fi

# Security Review
if [[ "$RUN_SECURITY" == "true" ]]; then
  codex exec "Security Review:
  1) Run 'npm audit' to check vulnerabilities
  2) Search for hardcoded secrets, API keys, or tokens
  3) Check for sensitive data in console.log statements (missing __DEV__ guard)
  4) Find exposed credentials in config files
  Format: File:Line - Issue - Severity (high/medium/low)" \
  > /tmp/codex-review/security-review.txt 2>&1 &
fi

# 全プロセスの完了を待機
wait
```

### Step 3: 統合レポート生成

Read tool で各レビュー結果を読み込み、以下の形式でレポートを生成:

```markdown
# 🤖 Codex Review Report

**実行日時**: YYYY-MM-DD HH:MM
**対象**: プロジェクト

---

## 📝 Code Review

[/tmp/codex-review/code-review.txt の内容]

---

## 🎨 UI Consistency Review

[/tmp/codex-review/ui-review.txt の内容]

---

## 🔒 Security Review

[/tmp/codex-review/security-review.txt の内容]

---

## 📊 Summary

| カテゴリ | 問題数 | 重大度別 |
|---------|--------|----------|
| Code | N | error: X, warning: Y |
| UI | N | warning: Y |
| Security | N | high: X, medium: Y |

---

*Generated by Codex CLI + Claude Code*
```

### Step 4: レポート保存

レポートを以下の場所に保存:

```bash
# タイムスタンプ付きでレポート保存
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
REPORT_PATH="docs/reviews/codex-review-${TIMESTAMP}.md"

# Write tool で保存
```

## 出力

1. **コンソール出力**: レビューサマリー
2. **ファイル出力**: `docs/reviews/codex-review-YYYYMMDD_HHMMSS.md`
3. **一時ファイル**: `/tmp/codex-review/*.txt`（詳細結果）

## 統合ワークフロー

`/impl-loop --with-codex` と連携して使用:

```
/impl-loop <feature> [tasks] --with-codex
├─ Claude: TDD実装 + レビュー
└─ Codex: /codex-review --all （並列実行）
    ↓
  統合レポート生成
```

## 注意事項

- Codex CLI がインストール済みであること
- ネットワーク接続が必要
